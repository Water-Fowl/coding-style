# Railsスタイルガイド
このスタイルガイドは、個人の裁量になってしまいそうな部分の判断基準を明確にするためのものである。

## API設計
基本的には、RESTfulの思想に基づいてURIの設計を行う。

## 原則

### CRUD以外のアクションは作らない
基本的には、CRUD以外のアクションを実装してはならない。
個人の裁量によってコントローラーが分割されるのは好ましくないので、この制約を設ける。
これにより、コントローラーにロジックを実装したとしても、巨大なファイルができあがることはほとんどない。

### 適切なタイミングで構造化をする
今の開発では、`Decorator`、`Service`、`Finder` Patternを使用している。
極端に色んなオブジェクトにコードが分散するのはよくないので、適切なタイミングでコントローラの実装をこれらのオブジェクトの中に実装していく。

#### Decorator Pattern
これは、`view`に依存した処理が冗長になってしまう際に使用するオブジェクト。
clientで扱いやすいデータ型にするための処理などは、ここの中に実装する。

#### Service Pattern
これは、副作用を伴う処理が冗長になってしまう際に使用するオブジェクト。
ここでいう副作用は、データベースにおける副作用のみを示す。
`create`の処理や`update`の処理などで、新しいデータを登録したり、更新したりするための複雑な処理は、ここに実装する。

#### Finder Pattern
これは、データを検索する際に、whereのメソッドチェーンなどによってコードが冗長になってしまう際に使用するオブジェクト。
whereが3つ以上続く場合や、パラメータの有無によって挙動が変わる場合などは、検索処理をここに実装する。

### 構造化されたオブジェクトのインターフェースを統一する
基本的には、Service Objectなどのオブジェクトは、`call`メソッドのみをパブリックなインターフェースとする。
また、クラスをインスタンス化せず、クラスを直接`call`することで処理を呼び出せるようにする。
具体的な実装方法はコードを参考されたい。

## Test設計
基本的には、RSpecを用いてTestを開発する。

### model spec
modelのテストは、publicなメソッドのみに対して行う。

#### scopeのテスト
##### テストすべき項目
- 値が正しく返ってきているかどうか
    - この時、返ってくる値のデータ型が違うので、`pluck(:id)`などのメソッドを使ってデータを照合する。

##### フォーマット
- describe
scopeの中にネストして、scopeのメソッド名を書く。
- it
帰ってきて欲しい値がどのようなものかを書く。

```ruby
describe "scopes" do
    describe "of_not_user_units" do
      it "指定したユーザーを含むUnitを返す" do
        expect(Score.of_not_user_units(Unit.first.users.first).pluck(:id)).to eq Unit.second.scores.pluck(:id)
      end
    end
end

```

## request spec
コントローラーの動作を確認するときは、request specを使用することが推奨されているため、こちらを採用する。

#### テスト項目
- 正しい値を入れたときに、ステータスコード200を返す
- コントローラーの挙動の整合性を確かめるために、変化している値が妥当かどうかを照合する

#### フォーマット
- describe
エンドツーエンドのテストなので、コントローラのメソッド名ではなく、HTTPのメソッド名と、叩くエンドポイントを記述する。
``` ruby
describe "GET /users" do
  ...
end

```

```ruby
describe "POST /games" do
  ...
end

```
- it
帰ってきて欲しい値がどのようなものかを書く。
